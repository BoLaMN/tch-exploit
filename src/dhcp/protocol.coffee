SeqBuffer = require './seqbuffer'

module.exports =
  parse: (buf) ->
    if buf.length < 230
      throw new Error 'Received data is too short'

    sb = new SeqBuffer buf

    op: sb.getUInt8()
    htype: htype = sb.getUInt8()
    hlen: hlen = sb.getUInt8()
    hops: sb.getUInt8()
    xid: sb.getUInt32()
    secs: sb.getUInt16()
    flags: sb.getUInt16()
    ciaddr: sb.getIP()
    yiaddr: sb.getIP()
    siaddr: sb.getIP()
    giaddr: sb.getIP()
    chaddr: sb.getMAC(htype, hlen)
    sname: sb.getUTF8(64)
    file: sb.getUTF8(128)
    magicCookie: sb.getUInt32()
    options: sb.getOptions()

  format: (data) ->
    sb = new SeqBuffer

    sb.addUInt8 data.op
    sb.addUInt8 data.htype
    sb.addUInt8 data.hlen
    sb.addUInt8 data.hops
    sb.addUInt32 data.xid
    sb.addUInt16 data.secs
    sb.addUInt16 data.flags
    sb.addIP data.ciaddr
    sb.addIP data.yiaddr
    sb.addIP data.siaddr
    sb.addIP data.giaddr
    sb.addMac data.chaddr
    sb.addUTF8Pad data.sname, 64
    sb.addUTF8Pad data.file, 128
    sb.addUInt32 0x63825363
    sb.addOptions data.options
    sb.addUInt8 255

    sb
